//>>built
define("dojo/request/iframe","module,require,./watch,./util,./handlers,../_base/lang,../query,../has,../dom,../dom-construct,../_base/window".split(","),function(i,r,v,n,w,t,x,j,u,s,d){function y(){return!this.isFulfilled()}function z(){return!!this._finished}function A(a,c){if(!c)try{var o=a.options,f=b.doc(b._frame),e=o.handleAs;if("html"!==e){if("xml"===e)if("html"===f.documentElement.tagName.toLowerCase()){x("a",f.documentElement).orphan();var d=f.documentElement.innerText,d=d.replace(/>\s+</g,
"><");a.text=t.trim(d)}else a.data=f;else a.text=f.getElementsByTagName("textarea")[0].value;w(a)}else a.data=f}catch(h){c=h}c?this.reject(c):this._finished?this.resolve(a):this.reject(Error("Invalid dojo/request/iframe request state"))}function B(){this._callNext()}function b(a,c,o){var d=n.parseArgs(a,n.deepCreate(C,c),!0),a=d.url,c=d.options;if("GET"!==c.method&&"POST"!==c.method)throw Error(c.method+" not supported by dojo/request/iframe");if(!b._frame)b._frame=b.create(b._iframeName,k+"();");
a=n.deferred(d,null,y,z,A,B);a._callNext=function(){if(!this._calledNext)this._calledNext=!0,b._currentDfd=null,b._fireNextRequest()};b._dfdQueue.push(a);b._fireNextRequest();v(a);return o?a:a.promise}var i=i.id.replace(/[\/\.\-]/g,"_"),k=i+"_onload";d.global[k]||(d.global[k]=function(){var a=b._currentDfd;if(a){var c=u.byId(a.response.options.form);if(c){for(var d=a._contentToClean,f=0;f<d.length;f++)for(var e=d[f],g=0;g<c.childNodes.length;g++){var h=c.childNodes[g];if(h.name===e){s.destroy(h);
break}}a._originalAction&&c.setAttribute("action",a._originalAction);if(a._originalTarget)c.setAttribute("target",a._originalTarget),c.target=a._originalTarget}a._finished=!0}else b._fireNextRequest()});var C={method:"POST"};b.create=function(a,c,b){if(d.global[a])return d.global[a];if(d.global.frames[a])return d.global.frames[a];b||(j("config-useXDomain")&&!j("config-dojoBlankHtmlUrl")&&console.warn("dojo/request/iframe: When using cross-domain Dojo builds, please save dojo/resources/blank.html to your domain and set dojoConfig.dojoBlankHtmlUrl to the path on your domain to blank.html"),
b=j("config-dojoBlankHtmlUrl")||r.toUrl("dojo/resources/blank.html"));c=s.place('<iframe id="'+a+'" name="'+a+'" src="'+b+'" onload="'+c+'" style="position: absolute; left: 1px; top: 1px; height: 1px; width: 1px; visibility: hidden">',d.body());return d.global[a]=c};b.doc=function(a){if(a.contentDocument)return a.contentDocument;var c=a.name;if(c){var b=d.doc.getElementsByTagName("iframe");if(a.document&&b[c].contentWindow&&b[c].contentWindow.document)return b[c].contentWindow.document;if(d.doc.frames[c]&&
d.doc.frames[c].document)return d.doc.frames[c].document}return null};b.setSrc=function(a,b,o){a=d.global.frames[a.name];if(a.contentWindow)a=a.contentWindow;try{o?a.location.replace(b):a.location=b}catch(f){}};b._iframeName=i+"_IoIframe";b._notifyStart=function(){};b._dfdQueue=[];b._currentDfd=null;b._fireNextRequest=function(){var a;try{if(!b._currentDfd&&b._dfdQueue.length){do a=b._currentDfd=b._dfdQueue.shift();while(a&&(a.canceled||a.isCanceled&&a.isCanceled())&&b._dfdQueue.length);if(!a||a.canceled||
a.isCanceled&&a.isCanceled())b._currentDfd=null;else{var c=a.response,d=c.options,f=a._contentToClean=[],e=u.byId(d.form),g=n.notify,h=d.data||null;if(e){if(h){var i=function(a,b){s.create("input",{type:"hidden",name:a,value:b},e);f.push(a)},l;for(l in h){var m=h[l];if(t.isArray(m)&&1<m.length)for(var j=0;j<m.length;j++)i(l,m[j]);else e[l]?e[l].value=m:i(l,m)}}var p=e.getAttributeNode("action"),k=e.getAttributeNode("method"),q=e.getAttributeNode("target");if(c.url)a._originalAction=p?p.value:null,
p?p.value=c.url:e.setAttribute("action",c.url);k?k.value=d.method:e.setAttribute("method",d.method);a._originalTarget=q?q.value:null;q?q.value=b._iframeName:e.setAttribute("target",b._iframeName);e.target=b._iframeName;g&&g.emit("send",c,a.promise.cancel);b._notifyStart(c);e.submit()}else g&&g.emit("send",c,a.promise.cancel),b._notifyStart(c),b.setSrc(b._frame,c.url,!0)}}}catch(r){a.reject(r)}};n.addCommonMethods(b,["GET","POST"]);return b});